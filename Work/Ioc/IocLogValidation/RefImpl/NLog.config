<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
      autoReload="true" 
      throwExceptions="true" 
      internalLogFile="nlog.log" 
      internalLogLevel="Info" >

  <!-- 
  See http://nlog-project.org/wiki/Configuration_file 
  for information on customizing logging rules and outputs.
   -->
  <extensions>
    <add assembly="IocLogValidationBibl" />
    <add assembly="IocLogValidation" />
  </extensions>
  <targets>
    <!-- Folgende Einstellungen gelten für alle Targets die sich in diesem targets Element befinden -->
    <!-- Zuerst werden die Meldungen nur in 5er Packen geschrieben -->
    <!-- Dann werden die Schreib Operationen immer in einem try/catch Block ausgeführt sodass ein retry möglich wird -->
    <default-wrapper xsi:type="BufferingWrapper" bufferSize="5" >
        <wrapper-target xsi:type="RetryingWrapper" />
    </default-wrapper>
    <target xsi:type="File" 
            name="ExceptionFileWriter" 
            archiveAboveSize="1000000"
            archiveFileName="${basedir}/logs/ExceptionFileWriter-${date:format=yyyy-MM-dd-HH-mm-ss}.log"
            fileName="${basedir}/logs/ExceptionFileWriter.log"
            layout="#### ${longdate} ${uppercase:${level}} ${message} ${event-context:item=DetailedMessage}" />
    <target xsi:type="File"
            name="f1"
            fileName="${basedir}/logs/targetf1-${shortdate}.log"
            layout="${longdate} ${uppercase:${level}} ${message}" />
    <target xsi:type="File"
            name="f2"
            fileName="${basedir}/logs/targetf2-${date:format=yyyy-MM-dd-HH}.log"
            layout="${longdate} ${uppercase:${level}} ${message}" />
    <target xsi:type="File"
            name="SapFileWriter"
            archiveAboveSize="1000000"
            archiveFileName="${basedir}/logs/targetf3-${date:format=yyyy-MM-dd-HH-mm-ss}.log"
            fileName="${basedir}/logs/SapFileWriter.log"
            layout="${longdate} ${uppercase:${level}} ${event-context:item=anmeldename} ${event-context:item=bapi} ${event-context:item=params}" />
  </targets>
  <targets>
    <target name="DatabaseLog" 
            xsi:type="DatabaseLog" />
    <target xsi:type="ElmahTarget"
            name="elmah" />
  </targets>
  <rules>
    <logger name="SapLogger" 
            level="Trace" 
            writeTo="DatabaseLog" />
    <logger name="SapLogger"
            level="Trace"
            writeTo="SapFileWriter" />
    <logger name="*Controller" 
            level="Trace" 
            writeTo="f1" />
    <logger name="Global"
            level="Trace"
            writeTo="f2" />
    <logger name="ElmahLogger"
            minlevel="Trace"
            writeTo="elmah" />
    <logger name="Exception"
            minlevel="Trace"
            writeTo="ExceptionFileWriter" />
  </rules>
</nlog>