<?xml version="1.0" encoding="utf-8" ?>
<ArrayOfDbMaintenanceTable>

  <DbMaintenanceTable>

    <SourceTableName>SapBapi</SourceTableName>
    
    <DestTableName>SapBapiReadOnly</DestTableName>

    <TableIndexColumnNames>userID, customerID</TableIndexColumnNames>

    <Steps>
      <DbMaintenanceStep IgnoreSqlException="true">
        <Description>
          Try creating table '[DestTableName]' ...
        </Description>

        <Sql>
          CREATE TABLE `[DestTableName]` (
          `Id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT ' ',
          `Anmeldename` char(40) NOT NULL,
          `Bapi` char(40) NOT NULL,
          `Status` bit(1) NOT NULL,
          `time_stamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
          `dauer` decimal(8,4) DEFAULT NULL,
          `AppId` int(11) DEFAULT NULL,
          `userID` int(11) DEFAULT NULL,
          `customerID` int(11) DEFAULT NULL,
          `kunnr` int(11) DEFAULT NULL,
          `portalType` int(11) DEFAULT NULL,
          PRIMARY KEY (`Id`)
          ) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;
        </Sql>
      </DbMaintenanceStep>

      <DbMaintenanceStep IsSqlIndexStatement="true" IgnoreSqlException="true">
        <Description>
          Try dropping indexes on table '[DestTableName]' ...
        </Description>

        <Sql>
          DROP INDEX `i_[DestTableName]_[IndexColumnName]` ON [DestTableName];
        </Sql>
      </DbMaintenanceStep>

      <DbMaintenanceStep>
        <Description>
          Cleaning table '[DestTableName]' ...
        </Description>

        <Sql>
          DELETE FROM `[DestTableName]`;
        </Sql>
      </DbMaintenanceStep>

      <DbMaintenanceStep>
        <Description>
          Inserting data into table '[DestTableName]' ...
        </Description>
    
        <Sql>
          INSERT INTO `[DestTableName]`
          (
          `Id` ,
          `Anmeldename` ,
          `Bapi` ,
          `Status` ,
          `time_stamp` ,
          `dauer` ,
          `AppId` ,
          `userID` ,
          `customerID` ,
          `kunnr` ,
          `portalType`
          )
          SELECT
          `Id` ,
          `Anmeldename` ,
          `Bapi` ,
          `Status` ,
          `time_stamp` ,
          `dauer` ,
          `AppId` ,
          `userID` ,
          `customerID` ,
          `kunnr` ,
          `portalType`
          from [SourceTableName];
        </Sql>
      </DbMaintenanceStep>
      <DbMaintenanceStep IsSqlIndexStatement="true">
        <Description>
          Adding indexes to table '[DestTableName]' ...
        </Description>

        <Sql>
          CREATE INDEX `i_[DestTableName]_[IndexColumnName]` ON `[DestTableName]` (`[IndexColumnName]`);
        </Sql>

        <IsSqlIndexStatement>true</IsSqlIndexStatement>
      </DbMaintenanceStep>
    </Steps>
  </DbMaintenanceTable>
</ArrayOfDbMaintenanceTable>