<!-- BEGIN CORE PLUGINS -->
<script src="~/assets/plugins/jquery-1.8.3.min.js" type="text/javascript"></script>   
<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->  
    

@(Html.Telerik().ScriptRegistrar().Globalization(true).DefaultGroup(group => group.Combined(true).Compress(true)))
@Scripts.Render("~/bundles/jqueryval")
<script src="~/assets/plugins/jquery-ui/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>      
<script src="~/assets/plugins/jquery-ui/jquery.ui.datepicker-de.js" type="text/javascript"></script>      
<script src="~/assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="~/assets/plugins/excanvas.js"></script>
<script src="~/assets/plugins/respond.js"></script>  
<![endif]-->   
<script src="~/assets/plugins/breakpoints/breakpoints.js" type="text/javascript"></script>  
<!-- IMPORTANT! jquery.slimscroll.min.js depends on jquery-ui-1.10.1.custom.min.js --> 
<script src="~/assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="~/assets/plugins/jquery.blockui.js" type="text/javascript"></script>  
<script src="~/assets/plugins/jquery.cookie.js" type="text/javascript"></script>
<script src="~/assets/plugins/uniform/jquery.uniform.min.js" type="text/javascript" ></script> 
<!-- END CORE PLUGINS -->

<!-- BEGIN PAGE LEVEL PLUGINS -->
<script type="text/javascript" src="~/assets/plugins/bootstrap-fileupload/bootstrap-fileupload.js"></script>
<script type="text/javascript" src="~/assets/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js"></script>
<script type="text/javascript" src="~/assets/plugins/chosen-bootstrap/chosen/chosen.jquery.min.js"></script>
<script type="text/javascript" src="~/assets/plugins/bootstrap-daterangepicker/date.js"></script>
<script type="text/javascript" src="~/assets/plugins/bootstrap-daterangepicker/daterangepicker.js"></script> 
<!-- END PAGE LEVEL PLUGINS -->

<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="~/assets/scripts/app.js" type="text/javascript"></script>
<script src="~/assets/scripts/index.js" type="text/javascript"></script>        
    
<script src="~/scripts/jquery.readableXML.js" type="text/javascript"></script>        
   

<!-- END PAGE LEVEL SCRIPTS -->  
<script type="text/javascript">

    jQuery(document).ready(function () {

        App.init(); // initlayout and core plugins
        //UIJQueryUI.init();

        FormInitStyles();

        FormPrepareLayoutPrivate();

        FormPreparePrivate();

        PrepareCheckSessionTimeout();
    });

    function FormPrepareAjax() {

        App.initUniform();

        FormInitStyles();

        FormPrepareAjaxLayoutPrivate();
    }

    function FormInitStyles() {

        FormInitValidationErrorStyles();

        FormInitDatePicker();
    }

    function FormInitValidationErrorStyles() {
        if (_controlGroupValidationType == 'default')
            FormInitValidationErrorStyles_ControlGroupDefault();
        if (_controlGroupValidationType == 'individual')
            FormInitValidationErrorStyles_ControlGroupIndividual();            
    }

    function FormInitValidationErrorStyles_ControlGroupDefault() {
        $('.input-validation-error').each(function () {
            var controlGroupDiv = $(this).closest('div[class^="control-group"]');
            if (controlGroupDiv != null)
                controlGroupDiv.addClass('error');
        });
    }

    function FormInitValidationErrorStyles_ControlGroupIndividual() {
        $('.input-validation-error').each(function () {
            var controlGroupDiv = $(this).closest('div[class^="control-group"]');
            if (controlGroupDiv != null) {
                controlGroupDiv.children('.control-label').each(function() {
                        $(this).addClass('input-validation-error');
                });

                controlGroupDiv.children('.controls').children('.no-break-container').each(function () {
                    if ($(this).find('.input-validation-error').length > 0)
                        $(this).addClass('input-validation-error');
                });
            };
        });
    }

    function FormInitDatePicker() {
        $(".datepicker").each(function () {
            var datePicker = $(this);
            datePicker.children("input").datepicker();
            datePicker.children(".add-on").click(function () {
                datePicker.children("input").datepicker("show");
            });
        });
    }

    var _loadingShowIgnore = false;

    $.ajaxSetup({
        beforeSend: function () {
            if (!_loadingShowIgnore)
                LoadingShow();
        },
        complete:function(){
            if (!_loadingShowIgnore)
                LoadingHide();
        }
    });

    function LoadingShow() {
        App.blockUI($(".portlet"));
    }

    function LoadingHide() {
        App.unblockUI($(".portlet"));
    }

    function PrepareCheckSessionTimeout() {
        setTimeout('CheckSessionTimeout()', 30000);
    }

    function CheckSessionTimeout() {

        _loadingShowIgnore = true;

        $.ajax({
            type: "POST",
            url: "CheckLogonTimeout",
            success: function (result) {

                _loadingShowIgnore = false;

                if (typeof (result.timeoutOccurred) !== "undefined" && result.timeoutOccurred) {
                    alert("Sicherheitshinweis:  Ihre Sitzung ist abgelaufen, aus Sicherheitsgründen bitten wir Sie sich neu anzumelden.");

                    if (typeof(parent) !== "undefined" && parent.location.href.toLowerCase().indexOf(".aspx") != -1) {
                        // we are in a iframe here (Services integrated) 
                        // => navigate parent window to our login page
                        parent.location.replace('/Services/Start/Login.aspx');
                    } else {
                        // we are in a full mvc layout page 
                        // => let's refresh our own window only (LogonContext has already been reset inside our session)
                        location.reload();
                    }
                    return;
                }

                PrepareCheckSessionTimeout();
            }
        });
    }

    function SpanAlert(id, message, delay) {
        if (delay == null)
            delay = 2000;
        var span = $("#" + id);
        span.find("span").html(message);
        span.fadeIn(300).delay(delay).fadeOut(300);
    }
    
</script>
