<style type="text/css">
    .PartnerAddressSubGrid {
        margin-left: 0px;
    }
    .PartnerAddressSubGrid .t-grid, .PartnerAddressSubGrid .t-grid .t-grid-toolbar {
        margin: 0!important;
        padding: 0!important;
    }
    .PartnerAddressSubGrid div.grid-toolbar {
        width: 363px;
    }
    .PartnerAddressSubGrid .t-grid-toolbar, .PartnerAddressSubGrid .t-status-text {
        color: #808080;
    }
    .PartnerAddressSubGrid .dataTables_length, .PartnerAddressSubGrid .t-grouping-header {
        display: none;   
    }
    .PartnerAddressSubGrid .dataTables_filter *, .PartnerAddressSubGrid .t-status-text {
        font-size: 0.9em!important;
    }
    .PartnerAddressSubGrid .outer-export-menu button {
        margin-top: 5px;
        padding: 2px;
        font-size: 11px;
    }
    .PartnerAddressSubGrid .dataTables_filter input {
        height: 15px;
    }
</style>

<script type="text/javascript">

    var _modelStateValid = 'false';

    function FormPreparePrivate() {
        FormPreparePrivateAdressenPflege();
    }

    function FormPreparePrivateAjax() {
        FormPrepareAjax();
    }

    var _dropdownCurrent = null;
    var _dropdownGridCurrent = null;

    function PickPartnerAddress(partnerKennung) {

        var dropdownThis = $("#" + partnerKennung.substr(0, 1) + "-" + "dropdown");
        if (_dropdownCurrent != null) {
            if (_dropdownCurrent.attr("id") != dropdownThis.attr("id")) {
                ClosePartnerAddressGrid("PickPartnerAddress('" + partnerKennung + "')");
                return false;
            }
            ClosePartnerAddressGrid();
            return false;
        }

        _dropdownCurrent = dropdownThis;
        _dropdownGridCurrent = $("#" + partnerKennung.substr(0, 1) + "-" + "dropdown-grid");

        $.ajax(
        {
            type: "POST",
            url: "PickPartnerAddress",
            data: { partnerKennung: partnerKennung },
            loadingShow: true,
            success: function (result) {
                ShowPartnerAddressGrid(result);
            },
            error: function (result) {
                alert(result.data);
            }
        });

        return false;
    }
    
    function AddressSelect(id) {
        $.ajax(
        {
            type: "POST",
            url: "PickPartnerAddressFinished",
            data: { id: id },
            loadingShow: false,
            success: function (result) {
                //console.log(result.partnerKennung);
                //console.log(result.partnerName);
                var dropdownTextSpan = $("#" + result.partnerKennung.toLowerCase().substr(0, 1) + "-dropdown-text");
                console.log(dropdownTextSpan);
                dropdownTextSpan.html(result.partnerName);
                $("#" + result.partnerKennung.toLowerCase().substr(0, 1) + "-textbox").val(result.partnerID);

                ClosePartnerAddressGrid();
            },
            error: function (result) {
                alert(result.data);
            }
        });
    }
    
    function ShowPartnerAddressGrid(result) {
        _dropdownCurrent.find("i").removeClass("icon-chevron-right").addClass("icon-chevron-down");

        var partnerWindow = $("#PartnerDialog").data("tWindow");
        $("#InnerPartnerDialog").html(result);
        FormPreparePrivateAdressenPflege();

        $("#divGridEditStart").addClass("PartnerAddressSubGrid");
        $(".grid-column-overall-quick-filter-pick-start").parent().hide();
        partnerWindow.center().open();

        setTimeout(function () {
            $(".grid-column-overall-filter").focus();
        }, 500);
    }

    function ClosePartnerAddressGrid(postFunction) {
        var partnerWindow = $("#PartnerDialog").data("tWindow");
        partnerWindow.close();
        
        _dropdownCurrent.find("i").removeClass("icon-chevron-down").addClass("icon-chevron-right");
        _dropdownCurrent = null;
        _dropdownGridCurrent = null;

        if (typeof(postFunction) !== "undefined")
            eval(postFunction);
        else
            setTimeout("LoadingHide()", 50);
        
        return false;
    }
    
</script>
