@model CkgDomainLogic.Fahrzeuge.Models.HolBringService.Upload
<script>

    function UploadStart(e) {
        // because we are uploading in async mode, our "e.files" collection always has exact 1 entry:
        var fileName = e.files[0].name;

        if (fileName.toLowerCase().indexOf('.pdf') <= 0) {
            alert('@Localize.FileUploadOnlyPdfLegal');
            return false;
        }

        LoadingShow();

        return true;
    }

    function UploadFinished(e) {
        setTimeout("LoadingHide()", 1000);

        // clear only the UI of our Upload Control:
        $(this).children(".t-upload-files").remove();

        if (!e.response.success) {
            alert(e.response.message);
            return;
        }

        $('#PdfPreview').attr('src', 'ShowUploadedPdf');
        parent.document.getElementById('PdfPreview').contentWindow.location.reload();
        setTimeout(
            function () {
                $('#PdfPreview').removeClass("hidden");
            }, 2000);
    }

    function UploadError(e) {
        e.preventDefault();
        setTimeout("LoadingHide()", 1000);
        alert('@Localize.ErrorFileCouldNotBeSaved');
    }

    function RemovePdfFile() {
        alert("RemovePdfFile");
        $('.fileUpload').val("");
        $('#PdfPreview').addClass("hidden");
    }
    
</script>
<div id="DivUpload" class="margin-top-20">
    @using (Ajax.BeginForm("Upload", "HolBringService", null,
                new MvcAjaxOptions { UpdateTargetId = "DivUpload", OnComplete = "AjaxFormUploadComplete();" },
                    htmlAttributes: new { @class = "form-horizontal", id = "AjaxFormUpload" }))
    {
        @Html.FormValidationSummary()
        
        <h3>Werkstattauftrag</h3>
        
        <div class="row-fluid">
            <div class="span7">
                <div class="control-group">
                    <label class="control-label">@Localize.UploadPdfFile:</label>
                    <div class="controls">
                        @(Html.Telerik().Upload()
                              .Name("fileUpload")
                              .Localizable("de-DE")
                              .Async(async => async
                                                  .Save("UploadPdfStart", "HolBringService")
                                                  .SaveField("uploadFiles")
                                                  .AutoUpload(true))
                              .Multiple(false)
                              .ShowFileList(false)
                              .ClientEvents(events => events
                                                          .OnUpload("UploadStart")
                                                          .OnSuccess("UploadFinished")
                                                          .OnError("UploadError")
                              )
                              )
                    </div>
                </div>
                
                <div id="DivPdfPreview">
                    <iframe id="PdfPreview" src="ShowUploadedPdf" frameborder="0" scrolling="yes" width="100%" height="400" class=""></iframe>
                </div>

            </div>
            <div class="span5">
                <button onclick="RemovePdfFile();" type="button" class="btn green">
                    <i class="icon-ok"></i> Datei entfernen</button>
            </div>
        </div>
        
        <script type="text/javascript">
                _modelIsValid = @ViewContext.ViewData.ModelState.IsValid.ToString().ToLower();

                $(function() {
                    @if (Model.PdfBytes != null)
                    {
                        <text>$('#PdfPreview').removeClass("hidden");</text>
                    }
                    else
                    {
                        <text>$('#PdfPreview').addClass("hidden");</text>
                    }
                });
        </script>
        
            }
</div>
