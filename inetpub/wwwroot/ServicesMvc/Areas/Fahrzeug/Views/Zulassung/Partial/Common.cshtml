<style type="text/css">
    
    span.reqired-fields {
        font-size: 0.8em !important;
    }
    
    div.presets-and-filter {
        background-color: #fcfcfc;
        padding: 5px 0 0 0;
        border: 1px solid #fafafa;
        margin: 0 0 20px 0;
    }
    div.presets-and-filter input[type='text'] {
        background-color: white!important;
    }
    
</style>

<script type="text/javascript">

    var ladeHinweis = '@Localize.LoadingData';
    var _modelIsValid = false;

    function FormPreparePrivate() {

        try { FormWizardInitPrivate(); } catch (e) { }

        // move our grid filter form into grid's toolbar:
        GridAllColumnFilterApplyToGrid("GridFahrzeugAuswahl");

        try { MultiSelectPreparePrivate(); } catch (e) { }

        InitSearchableAndEditableDropdowns();
    };

    function FormPreparePrivateAjax() {
        FormPrepareAjax();
        $('.tooltips').tooltip();
    }
    
    function FormWizardInitPrivate() {
        FormWizard.Init(function () {
            FormWizard.ActionsShow(!FormWizard.HasStepKey('FahrzeugAuswahl') && typeof(_formErrorHint) == 'undefined');
        });

        FormWizard.OnNext(function (step, maxSteps) {
            if ('FahrzeugAuswahl' == FormWizard.GetStepKey(step - 1)) {
                return FahrzeugAuswahl();
            }
            if ('Zulassung' == FormWizard.GetStepKey(step - 1)) {
                $("#AjaxFormZulassung").submit();
                return false;
            }

            return true;
        });

        FormWizard.OnPrev(function (step, maxSteps) {
            if ('FahrzeugAuswahl' == FormWizard.GetStepKey(step)) 
                FormWizard.ActionsShow(true);
            return true;
        });

        FormWizard.OnSubmit(function () {
            
            AjaxRequestNextStep();

            return true;
        });

        FormWizard.OnRestart(function () {
            //alert('Ok, let´s restart! :)');
            LocationReloadWithoutQueryString();
        });
    }

    function GetGrid(gridName) {
        return $("#" + gridName).data("tGrid");
    }

    function GridRefresh(gridName) {
        GetGrid(gridName).pageTo(1);
    }

    function AjaxRequestNextStep() {
        $.ajax({
            type: "POST",
            url: FormWizard.GetNextTabKey(),
            data: {},
            loadingShow: true,
            success: function (result) {
                if (typeof (result.message) !== "undefined") {
                    alert(result.message);
                    return;
                }
                FormWizard.SetNextTabHtmlAndMoveNext(result);
            }
        });    
    }

    function FahrzeugAuswahl() {
        AjaxRequestNextStep();
        return false;
    }

   

    function OnDataBound_GridFahrzeugAuswahl() {
        FilteredData_Grid_OnDataBound($(this));
        $('.tooltips').tooltip();

        // prepare multi row selection
        App.initUniform();
        Grid_PrepareMultiRowSelected("GridFahrzeugAuswahl");
    }

    function OnLoad_GridFahrzeugAuswahl() {
        $('.t-no-data td').text(ladeHinweis);
    }

    function OnRowDataBound_GridFahrzeugAuswahl(e) {
        var isMissing = e.dataItem["IsMissing"];

        if (isMissing)
            $(e.row).addClass((e.row.sectionRowIndex % 2 == 0) ? "t-grid-error" : "t-grid-error-alt");
    }

    function OnColumnShowHide_GridFahrzeugAuswahl() {
        FilteredData_Grid_OnColumnShowHide($(this));
    }

    function OnColumnReorder_GridFahrzeugAuswahl() {
        FilteredData_Grid_OnColumnReorder($(this));
    }

    function OnSelectionChange_GridFahrzeugAuswahl(cb) {

        Grid_FormatMultiRowSelected(cb);

        $.ajax({
            type: "POST",
            url: "FahrzeugAuswahlSelectionChanged",
            data: { vin: cb.val(), isChecked: cb.is(':checked') },
            loadingShow: false,
            success: function (result) {
                var count = result.allSelectionCount;
                GridFahrzeugAuswahl_MultiSelectUpdate(result.allSelectionCount);
                FormWizard.ActionsShow(count > 0);
                if (count == 0) {
                    $("#FahrzeugAuswahlCount").addClass('hide');
                    return;
                }

                $("#FahrzeugAuswahlCount").removeClass('hide');
                $("#FahrzeugAuswahlCount > span").html('Sie haben ' + count + ' Fahrzeug' + (count == 1 ? '' : 'e') + ' ausgewählt!');
            }
        });
    }

    function GridFahrzeugAuswahl_OnAllSelectionChange(check) {
        $.ajax({
            type: "POST",
            url: "FahrzeugAuswahlSelectionChanged",
            data: { id: "", isChecked: check },
            loadingShow: true,
            success: function (result) {
                var count = result.allSelectionCount;
                GridFahrzeugAuswahl_MultiSelectUpdate(result.allSelectionCount);
                FormWizard.ActionsShow(count > 0);
                
                FilterGrid("GridFahrzeugAuswahl");
            }
        });
    }

    function GridFahrzeugAuswahl_MultiSelectUpdate(count) {
        if (count == 0) {
            $("#FahrzeugAuswahlCount").addClass('hide');
            $("#uncheckAllRecords").attr("checked", false);
            $.uniform.update($("#uncheckAllRecords"));
            return;
        }

        $("#FahrzeugAuswahlCount").removeClass('hide');
        $("#FahrzeugAuswahlCount > span").html('Sie haben ' + count + ' Fahrzeug' + (count == 1 ? '' : 'e') + ' ausgewählt!');
        $("#uncheckAllRecords").attr("checked", true);
        $.uniform.update($("#uncheckAllRecords"));
    }

    function OnDropdownChanged_SelectedKennzeichenSerie(val) {
        alert(val);
    }

    function OnDropdownChanged_SelectedPdi(val) {
        alert(val);
    }

    function OnDropdownChanged_SelectedModel(val) {
        alert(val);
    }

    function OnDropdownChanged_SelectedModelId(val) {
        alert(val);
    }

</script>

