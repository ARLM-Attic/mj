@model CkgDomainLogic.DataKonverter.ViewModels.KroschkeDataKonverterViewModel

<style type="text/css">
    .form-wizard .progress {
        margin-bottom: 10px!important;
    }
</style>

<script type="text/javascript">

    var _modelIsValid = false;
    var _customButtonText = '@(Model.ObjectKey.IsNullOrEmpty() ? Localize.AddToShoppingCart : Localize.UpdateShoppingCart)';

    function KroschkeZulassungFormPreparePrivate() {
        FormPreparePrivate();
    }

    function FormPreparePrivate() {
        try { FormWizardInitPrivate(); } catch (e) { }
        try { MultiSelectPreparePrivate(); } catch (e) { }
        ShoppingCartMenuRefreshCount();
    };

    function FormPreparePrivateAjax() {
        FormPrepareAjax();
        $('.tooltips').tooltip();
        setTimeout('LoadingHide()', 1000);
    }

    function FormWizardShowHideSaveButton(show, delay) {
        setTimeout(function () {
            $(".button-custom1 i").removeClass("m-icon-swapright").addClass("icon-shopping-cart");
            FormWizard.ButtonCustom1Show(show, _customButtonText);
        }, (typeof (buttonText) !== 'undefined' ? delay : 0));
    }

    function FormWizardInitPrivate() {
        FormWizard.Init(function () {
            FormWizard.ActionsShow(true);
            FormWizard.tabClickDisabled = true;
        });

        FormWizard.OnNext(function (step, maxSteps) {
            var stepName = FormWizard.GetStepKey(step - 1);

            try {
                $("#AjaxForm" + stepName).submit();
                window.scrollTo(0, 0);
                return false;
            }
            catch (e) {
                return true;
            }
        });

        FormWizard.OnPrev(function (step, maxSteps) {
            var stepName = FormWizard.GetStepKey(step + 1);

            FormWizardShowHideSaveButton(stepName == "Receipt", 500);

            var prevStepName = FormWizard.GetStepKey(step);
            if (prevStepName == "BankAdressdaten" && _skipBankAddressData) {
                FormWizard.ButtonPrevInvoke();
            }

            window.scrollTo(0, 0);
            return true;
        });

        FormWizard.OnCustom1(function (step, maxSteps) {
            SaveZulassung();

            return true;
        });

        FormWizard.OnSubmit(function () {
            LoadingShow();
            SpanAlertWarning("WaitHint", '@Localize.PleaseWaitWhileProcessingYourRequest.ToJavascriptString()', 120000);
            AjaxRequestNextStep();

            return true;
        });

        FormWizard.OnRestart(function () {
            LocationReloadWithoutQueryString();
        });
    }

    function GetGrid(gridName) {
        return $("#" + gridName).data("tGrid");
    }

    function GridRefresh(gridName) {
        GetGrid(gridName).pageTo(1);
    }

    function AjaxRequestNextStep() {
        var nextTabKey = FormWizard.GetNextTabKey();
        $.ajax({
            type: "POST",
            url: nextTabKey,
            data: {},
            loadingShow: true,
            success: function (result) {
                SpanAlertWarningHide("WaitHint");
                if (typeof (result.message) !== "undefined") {
                    alert(result.message);
                    return;
                }
                FormWizard.SetNextTabHtmlAndMoveNext(result);
                FormPreparePrivateAjax();

                if (nextTabKey.toLowerCase() == "receipt")
                    ShoppingCartMenuRefreshCount();
            }
        });
    }

    function SaveZulassung() {
        var nextTabKey = FormWizard.GetNextTabKey();
        $.ajax({
            type: "POST",
            url: "Save",
            data: {},
            loadingShow: true,
            success: function (result) {
                if (typeof (result.message) !== "undefined") {
                    alert(result.message);
                    return;
                }
                FormWizard.SetNextTabHtmlAndMoveNext(result);
                FormPreparePrivateAjax();

                if (nextTabKey.toLowerCase() == "receipt")
                    ShoppingCartMenuRefreshCount();
            },
            error: function (jqXhr, exception) {
                alert(jqXhr.responseText);
            }
        });
    }

    function ShoppingCartSubmitFinished(result) {
        $(".form-wizard").html(result);
        ShoppingCartHide();
        LoadingHide();
    }

    // Rechnungsdaten
    function AjaxFormRechnungsdatenComplete() {
        FormPrepareAjax();

        if (_modelIsValid) {
            AjaxRequestNextStep();
            return;
        }
    }

    // HalterAdresse
    function AjaxFormHalterAdresseComplete() {
        FormPrepareAjax();

        if (_modelIsValid) {
            AjaxRequestNextStep();
            return;
        }

        //var detailWindow = $("#Adressen").data("tWindow");
        //detailWindow.center().close();
        $(".mfp-close").trigger("click");
    }

    // ZahlerKfzSteuer
    function AjaxFormZahlerKfzSteuerComplete() {
        FormPrepareAjax();

        //var detailWindow = $("#Adressen").data("tWindow");
        //detailWindow.center().close();
        $(".mfp-close").trigger("click");

        if (_modelIsValid) {
            AjaxRequestNextStep();
            return;
        }
    }

    // BankAdressdaten
    function AjaxFormBankAdressdatenComplete() {
        FormPrepareAjax();

        if (_modelIsValid) {
            AjaxRequestNextStep();
            return;
        }
    }

    // AuslieferAdressen
    function AjaxFormAuslieferAdressenComplete() {
        FormPrepareAjax();

        //var detailWindow = $("#Adressen").data("tWindow");
        //detailWindow.center().close();
        $(".mfp-close").trigger("click");

        if (_modelIsValid) {
            AjaxRequestNextStep();
            return;
        }

        var saveSuccessful = $("#TmpSaveAddressSuccessful").val().toString().toLowerCase();
        if (saveSuccessful == 'true') {
            SpanAlertSuccess("AuslieferAdressenMessage", '@Localize.SaveSuccessful', 3000);
            $("#TmpSaveAddressSuccessful").val(false);
        }
    }

    // OptionenDienstleistungen
    function AjaxFormOptionenDienstleistungenComplete() {
        FormPrepareAjax();

        if (_modelIsValid) {
            AjaxRequestNextStep();
            return;
        }
    }
</script>
