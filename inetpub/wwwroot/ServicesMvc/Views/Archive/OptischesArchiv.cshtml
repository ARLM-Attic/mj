@using CkgDomainLogic.Archive.ViewModels
@model EasyAccessViewModel

<h3 class="page-title" id="headerTitle">Optisches Archiv <small></small></h3>

<p id="lblError"></p>

@section LayoutScript { _controlGroupValidationType = "individual"; }

@using (Html.FormSearchBox())
{
    <div id="divEasyAccessSuche"></div>
}

@using (Html.FormSearchResultsGrid())
{
    <div id="divEasyAccessGrid"></div>
    <div id="divEasyAccessDetail"></div>
}

<script type="text/javascript">

    var _modelStateValid = 'false';

    function FormPreparePrivate() {
        ShowSearchArea();
    }

    function FormPreparePrivateAjax() {
        FormPrepareAjax();
    }

    function GetGrid() {
        return $("#GridEasyAccessItems").data("tGrid");
    }

    function GridLoadingHide() {
        // needed for chrome browser: Explicitely hide grids loading icon on multiple subsequent grid ajax requests (because of filter control initializing)
        setTimeout('$("#GridEasyAccessItems .t-grid-pager .t-status .t-icon").removeClass("t-loading")', 500);
    }

    function GridRefresh() {
        GetGrid().ajaxRequest();
    }

    function OnDataBound_GridEasyAccess() {
        FilteredData_Grid_OnDataBound($(this));
        $('.tooltips').tooltip();
    }

    function OnColumnShowHide_GridEasyAccess() {
        FilteredData_Grid_OnColumnShowHide($(this));
    }

    function OnColumnReorder_GridEasyAccess() {
        FilteredData_Grid_OnColumnReorder($(this));
    }

    function ShowEasyAccessSearchArea(result) {
        $("#divEasyAccessSuche").html(result);
    }

    function ShowSearchArea() {
        $.ajax({
            type: "POST",
            url: "InitSearch",
            success: function (result) {
                ShowEasyAccessSearchArea(result);
                FormPreparePrivateAjax();
            }
        });
    }

    function RefreshSearchArea() {
        var arcType = $("#searchForm input[type=radio]:checked").val();
        $.ajax({
            type: "POST",
            url: "RefreshSearch",
            data: { archiveType: arcType },
            success: function (result) {
                ShowEasyAccessSearchArea(result);
                FormPreparePrivateAjax();
            }
        });
    }

    function ShowEasyAccessSearchResult(result) {
        SearchFormHide();
        $("#divEasyAccessGrid").html(result);

        // move our grid filter form into grid's toolbar:
        GridAllColumnFilterApplyToGrid("GridEasyAccess");

        $("#divEasyAccessDetail").html('');
        $("#divEasyAccessGrid").slideDown();    
    }

    function ShowEasyAccessDetail(result) {
        $("#divEasyAccessDetail").html(result);
        $("#divEasyAccessGrid").slideUp();
        $("#divEasyAccessDetail").slideDown();
        $("#btnBackToResult").show();
        setTimeout('LoadingHide()', 1000);
    }

    function CloseEasyAccessDetails() {
        $("#btnBackToDetails").hide();
        $("#divEasyAccessDetail").slideUp(function () { $("#divEasyAccessGrid").delay(200).slideDown(); window.scrollTo(0, 0); });
        FormPreparePrivateAjax();
    }

    function ViewDocumentDetails(docId) {
        $.ajax({
            type: "POST",
            url: "DocumentDetails",
            data: { docId: docId },
            success: function (result) {
                ShowEasyAccessDetail(result);
                FormPreparePrivateAjax();
            }
        });
    }

</script>
