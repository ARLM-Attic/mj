@using CkgDomainLogic.Finance.ViewModels
@model FinanceMahnstopViewModel

<h3 class="page-title" id="headerTitle">@Localize.Finance_MahnstopVorErsteingang <small></small></h3>

@section LayoutScript { _controlGroupValidationType = "individual"; }

@Html.SpanAlert("spanAlertMahnstop")

@Html.Partial("Mahnstop/MahnstopSuche", Model.DataService.Suchparameter)

<div id="divMahnstopsGrid"></div>

<script type="text/javascript">

    var ladeHinweis = '@Localize.LoadingData';

    function FormPreparePrivate() {
        GridAllColumnFilterApplyToGrid("GridMahnstops");
    }

    function FormPreparePrivateAjax() {
        FormPrepareAjax();
    }

    function GetGrid() {
        return $("#GridMahnstops").data("tGrid");
    }

    function GridLoadingHide() {
        // needed for chrome browser: Explicitely hide grids loading icon on multiple subsequent grid ajax requests (because of filter control initializing)
        setTimeout('$("#GridMahnstopsItems .t-grid-pager .t-status .t-icon").removeClass("t-loading")', 500);
    }

    function GridRefresh() {
        GetGrid().ajaxRequest();
    }

    function OnDataBound_GridMahnstops() {
        FilteredData_Grid_OnDataBound($(this));
        $('.tooltips').tooltip();
    }

    function OnLoad_GridMahnstops() {
        $('.t-no-data td').text(ladeHinweis);
    }

    function OnColumnShowHide_GridMahnstops() {
        FilteredData_Grid_OnColumnShowHide($(this));
    }

    function OnColumnReorder_GridMahnstops() {
        FilteredData_Grid_OnColumnReorder($(this));
    }

    function TryGridRefresh() {
        // Refresh grid only
        if (typeof (GetGrid()) !== "undefined") {
            GetGrid().ajaxRequest();
        }
    }

    function ApplyMahnstopsGridPartialView(result) {
        $("#divMahnstopsGrid").html(result);
        GridAllColumnFilterApplyToGrid("GridMahnstops");
    }

    function ShowMahnstopsSearchResult(result) {
        $("#btnBackToSearch").show();
        $("#divMahnstopsSuche").slideUp();
        $("#divMahnstopsGrid").slideDown();
        ApplyMahnstopsGridPartialView(result);
    }

    function CloseMahnstopsSearchResult() {
        $("#btnBackToSearch").hide();
        $("#divMahnstopsGrid").slideUp(function () { $("#divMahnstopsSuche").delay(200).slideDown(); window.scrollTo(0, 0); });
        FormPreparePrivateAjax();
    }

    function SaveMahnstops() {
        $.ajax(
        {
            type: "POST",
            url: "SaveMahnstops",
            loadingShow: true,
            success: function (result) {
                ApplyMahnstopsGridPartialView(result);
                if (_modelStateValid == 'true') {
                    var successMessage = '@Localize.SaveSuccessful.ToJavascriptString()';
                    SpanAlertSuccess("spanAlertMahnstop", successMessage, 1800);
                }
                FormPreparePrivateAjax();
            },
            error: function (result) {
                SpanAlertWarning("spanAlertMahnstop", result.data, 5000);
            }
        });

        return false;
    }

    function MahnstopEditFormFormPreparePrivate() {
        FormPrepareAjax();
    }

    function EditMahnstop(paid, equinr, matnr) {
        $.ajax(
            {
                type: "POST",
                url: "MahnstopEdit",
                data: { paid : paid, equinr : equinr, matnr : matnr },
                loadingShow: true,
                success: function (result) {
                    AjaxFormMahnstopEditShow(result);
                }
            });

        return false;
    }

    function AjaxFormMahnstopEditShow(result) {
        var detailWindow = $("#MahnstopBearbeiten").data("tWindow");
        $("#InnerMahnstopBearbeiten").html(result);
        detailWindow.center().open();
        MahnstopEditFormFormPreparePrivate();
    }

    function AjaxFormMahnstopEditClose() {
        $("#MahnstopBearbeiten").data("tWindow").close();
    }

</script>

@(Html.Telerik().Window()
    .Name("MahnstopBearbeiten")
    .Visible(false)
    .Title(Localize.DunningStop)
    .Modal(true)
    .Draggable(true)
    .Scrollable(false)
    .Width(500)
    .Height(300)
    .Content(@<text><div id="InnerMahnstopBearbeiten"></div></text>)
)