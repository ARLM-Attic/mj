@using CkgDomainLogic.Logs.Models
@model CkgDomainLogic.Logs.ViewModels.LogsViewModel 

@Html.Partial("Partial/Common")

<h3 class="page-title" id="headerTitle">Logs <small>Sap</small> </h3>

@using (Html.FormSearchBox())
{
    @Html.Partial("Partial/Sap/SucheSapLogItems", Model.SapLogItemSelector)
}

@using (Html.FormSearchResultsGrid())
{
    <div id="divGrid"></div>
}

<div>Legende:</div>
<div class="legend">
    @foreach (var preset in SapBapiDuration.LegendPresets)
    {
        <div class="legend-row">
            <span class="legend-color-item @preset.LevelCssClass"></span>
            <span class="legend-text-item">@preset.LevelAsString,  @preset.ThresholdUpFromSecondsAsString </span>
        </div>
    }
</div>


<script type="text/javascript">

    function FormPreparePrivate() {
        // move our grid filter form into grid's toolbar:
        GridAllColumnFilterApplyToGrid("GridLogsSap");

        PrepareDialogs();
    }
    
    function PrepareDialogs() {
        $(window).resize(function () {
            $('.ui-dialog').css({
                'width': $(window).width(),
                //'height': $(window).height(),
                'left': '0px',
                //'top': '0px'
            });
        }).resize(); //<-- resizes on page ready    
    }
    
    function FormPreparePrivateAjax() {
        FormPrepareAjax();
    }

    function ShowSapLogItemsSearchResult(result) {
        SearchFormHide();
        $("#divGrid").html(result);

        // move our grid filter form into grid's toolbar:
        GridAllColumnFilterApplyToGrid("GridLogsSap");

        $("#divGrid").slideDown();
    }

    function OnDataBound_GridLogsSap() {
        FilteredData_Grid_OnDataBound($(this));
        jQuery('.tooltips').tooltip();
        LoadingHide();
    }

    function OnColumnShowHide_GridLogsSap() {
        FilteredData_Grid_OnColumnShowHide($(this));
    }

    function OnColumnReorder_GridLogsSap() {
        FilteredData_Grid_OnColumnReorder($(this));
    }

    function OnRowDataBound_GridLogsSap(e) {
        var cssClass = e.dataItem["DauerCssClass"];

        $(e.row).addClass(cssClass);
    }

    var _gridAllColumnFilterQuickMouseClickFilter_isActive = false;
    function GridAllColumnFilterQuickMouseClickFilter() {
        _gridAllColumnFilterQuickMouseClickFilter_isActive = !_gridAllColumnFilterQuickMouseClickFilter_isActive;
        
        if (_gridAllColumnFilterQuickMouseClickFilter_isActive) {

            $(".t-grid table td")
                .on("click",
                    function () {
                        $(".grid-column-overall-filter").val($(this).text());
                        FilterGridAllColumns($(".grid-column-overall-filter"));
                        $(this).removeClass("red");
                        GridAllColumnFilterQuickMouseClickFilter();
                    })
                .hover(
                    function () {
                        $(this).addClass("red");
                    },
                    function () {
                        $(this).removeClass("red");
                    }
                );

        } else {
            $(".t-grid table td").off("click").unbind("hover");
        }
    }
    
</script>