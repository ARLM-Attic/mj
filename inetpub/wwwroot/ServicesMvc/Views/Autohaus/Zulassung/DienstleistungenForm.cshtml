@using CkgDomainLogic.Autohaus.Models
@model ZulassungsDienstleistungen

<div id="DivDienstleistungen" class="margin-top-20">
    @using (Ajax.BeginForm("DienstleistungenForm", "Autohaus", null,
                new MvcAjaxOptions { UpdateTargetId = "DivDienstleistungen", OnComplete = "AjaxFormDienstleistungenComplete();" },
                    htmlAttributes: new { @class = "form-horizontal", id = "AjaxFormDienstleistungen" }))
    {
        @Html.FormValidationSummary()
        
        
        <div class="dienstleistungen-wrapper">
            
            @Html.HiddenFor(m => m.GewaehlteDienstleistungenString)

            <div class="dienstleistungen-header">
                <span class="header-left">Verfügbare Dienstleistungen</span>
                <span class="header-right">Gewählte Dienstleistungen</span>
            </div>

            <select multiple id="pre-selected-options" class="multiselect hide" name="pre-selected-options[]">
                @foreach (var dienstleistung in Model.AvailableDienstleistungen)
                {
                    <option value="@dienstleistung.ID" @dienstleistung.SelectedAsString>@dienstleistung.Name</option>
                }
            </select>
        </div>
        

        <script type="text/javascript">

            _modelIsValid = @ViewContext.ViewData.ModelState.IsValid.ToString().ToLower();

            MultiSelectPreparePrivate();

            function MultiSelectPreparePrivate() {
                $('#pre-selected-options').multiSelect();

                $('#ms-pre-selected-options > .ms-selectable > .ms-list > li').each(function () {
                    $(this).append('<i class="icon-chevron-right"></i>');
                });
                $('#ms-pre-selected-options > .ms-selection > .ms-list > li').each(function () {
                    $(this).prepend('<i class="icon-ok dienstleistung-gewaehlt"></i>');
                    $(this).append('<i class="icon-remove"></i>');
                });
                $('#ms-pre-selected-options').removeClass('hide');

                $('#pre-selected-options').change(function() {
                    var selectedOptions = '';
                    $('.ms-selection > .ms-list > .ms-selected').each(function () {
                        selectedOptions += (selectedOptions != '' ? ',' : '') + $(this).attr('id').replace(/-selection/, '');
                    });
                    $("#GewaehlteDienstleistungenString").val(selectedOptions);
                });
            }

        </script>
    }
</div>
