@using CkgDomainLogic.KroschkeZulassung.Models
@model OptionenDienstleistungen

<div id="DivOptionenDienstleistungen" class="margin-top-20">
    @using (Ajax.BeginForm("OptionenDienstleistungenForm", "KroschkeZulassung", null,
                new MvcAjaxOptions { UpdateTargetId = "DivOptionenDienstleistungen", OnComplete = "AjaxFormOptionenDienstleistungenComplete();" },
                    htmlAttributes: new { @class = "form-horizontal label-width-175", id = "AjaxFormOptionenDienstleistungen" }))
    {
        @Html.FormValidationSummary()
        
        
        <div class="dienstleistungen-wrapper">
            
            @Html.HiddenFor(m => m.GewaehlteDienstleistungenString)

            <div class="dienstleistungen-header">
                <span class="header-left">@Localize.AvailableServices</span>
                <span class="header-right">@Localize.SelectedServices</span>
            </div>

            <select multiple id="pre-selected-options" class="multiselect hide" name="pre-selected-options[]">
                @foreach (var dl in Model.AvailableDienstleistungen)
                {
                    <option value="@dl.ID" @dl.SelectedAsString>@dl.Name</option>
                }
            </select>
        </div>
        
        @Html.HiddenFor(m => m.ZulassungsartMatNr)
        @Html.HiddenFor(m => m.Ist72hVersandzulassung)
        @Html.HiddenFor(m => m.IstAbmeldung)
        @Html.HiddenFor(m => m.IstFirmeneigeneZulassung)
        @Html.HiddenFor(m => m.IstGebrauchtzulassung)
        @Html.HiddenFor(m => m.IstKurzzeitzulassung)
        @Html.HiddenFor(m => m.IstNeuzulassung)
        @Html.HiddenFor(m => m.IstUmkennzeichnung)
        @Html.HiddenFor(m => m.IstZollzulassung)
        
        @Html.FormCheckBoxFor(m => m.NurEinKennzeichen, new { @class = "m-wrap" })
        
        @Html.FormCheckBoxFor(m => m.KennzeichenSondergroesse, new { @class = "m-wrap xsmall" },
                                    postControlHtml: @<text>
                                                            @Html.DropDownListFor(m => m.KennzeichenGroesseId, Model.KennzeichengroesseListForMatNr.ToSelectList(), new { @class = "m-wrap small margin-left-50" })
                                                        </text>)

        @Html.FormCheckBoxFor(m => m.Saisonkennzeichen, new { @class = "m-wrap xsmall" },
                                    postControlHtml: @<text>
                                                            @Html.DropDownListFor(m => m.SaisonBeginn, OptionenDienstleistungen.SaisonMonate.ToSelectList(), new { @class = "m-wrap xsmall margin-left-50" })
                                                            @Html.DropDownListFor(m => m.SaisonEnde, OptionenDienstleistungen.SaisonMonate.ToSelectList(), new { @class = "m-wrap xsmall margin-left-10" })
                                                        </text>)
        
        if (Model.IstGebrauchtzulassung)
        {
            @Html.FormCheckBoxFor(m => m.KennzeichenVorhanden, new { @class = "m-wrap" })
        }
        else
        {
            @Html.HiddenFor(m => m.KennzeichenVorhanden)
        }

        if (Model.IstAbmeldung)
        {
            @Html.FormCheckBoxFor(m => m.VorhandenesKennzeichenReservieren, new { @class = "m-wrap" })
        }
        else
        {
            @Html.HiddenFor(m => m.VorhandenesKennzeichenReservieren)
        }

        if (Model.IstFirmeneigeneZulassung)
        {
            @Html.FormDatePickerFor(m => m.HaltedauerBis, new { @class = "m-wrap small" })
        }
        else
        {
            @Html.HiddenFor(m => m.HaltedauerBis)
        }

        if (Model.IstUmkennzeichnung)
        {
            @Html.FormTextBoxFor(m => m.AltesKennzeichen, new { @class = "m-wrap medium uppercase" })
        }
        else
        {
            @Html.HiddenFor(m => m.AltesKennzeichen)
        }
        
        @Html.FormTextAreaFor(m => m.Bemerkung, new { @class = "m-wrap large" })
        

        <script type="text/javascript">

            _modelIsValid = @ViewContext.ViewData.ModelState.IsValid.ToString().ToLower();

            MultiSelectPreparePrivate();

            function MultiSelectPreparePrivate() {
                $('#pre-selected-options').multiSelect();

                $('#ms-pre-selected-options > .ms-selectable > .ms-list > li').each(function () {
                    $(this).append('<i class="icon-chevron-right"></i>');
                });
                $('#ms-pre-selected-options > .ms-selection > .ms-list > li').each(function () {
                    $(this).prepend('<i class="icon-ok dienstleistung-gewaehlt"></i>');
                    $(this).append('<i class="icon-remove"></i>');
                });
                $('#ms-pre-selected-options').removeClass('hide');

                $('#pre-selected-options').change(function() {
                    var selectedOptions = '';
                    $('.ms-selection > .ms-list > .ms-selected').each(function () {
                        selectedOptions += (selectedOptions != '' ? ',' : '') + $(this).attr('id').replace(/-selection/, '');
                    });
                    $("#GewaehlteDienstleistungenString").val(selectedOptions);
                });
            }

        </script>
    }
</div>
