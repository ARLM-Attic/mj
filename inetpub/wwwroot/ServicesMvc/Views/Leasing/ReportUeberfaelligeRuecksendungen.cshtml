@using CkgDomainLogic.Leasing.ViewModels
@model UeberfaelligeRuecksendungenViewModel

<style>
    .m-wrap.tiny {
        width: 30px;
    }
</style>

<h3 class="page-title" id="headerTitle">@Localize.Leasing_UeberfaelligeRuecksendungen <small></small></h3>

<p id="lblError"></p>

@section LayoutScript { _controlGroupValidationType = "individual"; }

@using (Html.FormSearchBox())
{
    @Html.Partial("UeberfaelligeRuecksendungen/Suche", Model.DataService.Suchparameter)
}
    
@using (Html.FormSearchResultsGrid())
{
    <div id="divGrid"></div>
}

<script type="text/javascript">

    var _modelStateValid = false;

    function FormPreparePrivate() {
    }

    function FormPreparePrivateAjax() {
        FormPrepareAjax();
    }

    function GetGrid() {
        return $("#GridUeberfaelligeRuecksendungen").data("tGrid");
    }

    function GridLoadingHide() {
        // needed for chrome browser: Explicitely hide grids loading icon on multiple subsequent grid ajax requests (because of filter control initializing)
        setTimeout('$("#GridUeberfaelligeRuecksendungenItems .t-grid-pager .t-status .t-icon").removeClass("t-loading")', 500);
    }

    function GridRefresh() {
        GetGrid().ajaxRequest();
    }

    function OnDataBound_GridUeberfaelligeRuecksendungen() {
        FilteredData_Grid_OnDataBound($(this));
        $('.tooltips').tooltip();
    }

    function OnRowDataBound_GridUeberfaelligeRuecksendungen(e) {
        var grid = $(this).data("tGrid");
        var col = grid.columnFromMember("ZB1KopieVorhandenText");
        var colIndex = $.inArray(col, grid.columns);

        if (e.dataItem.ZB1KopieVorhanden.toUpperCase() == "JA") {
            e.row.cells[colIndex].style.backgroundColor = "green";
        } else {
            e.row.cells[colIndex].style.backgroundColor = "yellow";
        }
    }

    function OnColumnShowHide_GridUeberfaelligeRuecksendungen() {
        FilteredData_Grid_OnColumnShowHide($(this));
    }

    function OnColumnReorder_GridUeberfaelligeRuecksendungen() {
        FilteredData_Grid_OnColumnReorder($(this));
    }

    function ShowUeberfaelligeRuecksendungenSearchResult(result) {
        SearchFormHide();
        $("#divGrid").html(result);
        GridAllColumnFilterApplyToGrid("GridUeberfaelligeRuecksendungen");
        $("#divGrid").slideDown();
    }

    function MemoBearbeiten(equiNr) {
        $("#btnEdit" + equiNr).addClass("hide");
        $("#btnSave" + equiNr).removeClass("hide");
        $("#txt" + equiNr).prop('disabled', false);
    }

    function MemoSpeichern(equiNr) {
        var memo = $("#txt" + equiNr).val();

        $.ajax({
            type: "POST",
            url: "MemoSpeichern",
            data: { equiNr: equiNr, memo: memo },
            loadingShow: true,
            success: function (result) {
                FormPreparePrivateAjax();

                $("#btnSave" + equiNr).addClass("hide");
                $("#btnEdit" + equiNr).removeClass("hide");
                $("#txt" + equiNr).prop('disabled', true);

                GridRefresh();
            }
        });
    }

    function FristVerlaengern(equiNr) {
        $.ajax({
            type: "POST",
            url: "FristVerlaengern",
            data: { equiNr: equiNr },
            loadingShow: true,
            success: function (result) {
                FormPreparePrivateAjax();
                GridRefresh();
            }
        });
    }

</script>
