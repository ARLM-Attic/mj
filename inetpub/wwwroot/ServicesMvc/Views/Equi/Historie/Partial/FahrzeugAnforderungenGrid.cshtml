@using CkgDomainLogic.Equi.Models
@{ var gridName = "GridFahrzeugAnforderungen"; }

<div id="divFahrzeugAnforderungGrid">
    @(Html.Telerik()
          .Grid<FahrzeugAnforderung>()
          .Name(gridName)
          .XAjaxDataBinding("EquiHistorieVermieterFahrzeugAnforderungenAjaxBinding", "Equi")
          .Columns(columns =>
          {
              columns.XBound("").Filterable(false).Sortable(false).Title("")
                  .ClientTemplate("<span></span>")
                  .HeaderTemplate(
                      "<button onclick='FahrzeugAnforderungNew();' class='btn mini gray tooltips' data-original-title='" + Localize.ItemAdd + "' data-placement='right'><i class='halflings-icon white plus'></i></button>"
                  ); 
        
              columns.XBound(c => c.DokTyp);
              columns.XBound(c => c.Kennzeichen);
              columns.XBound(c => c.EmailExtern);
              columns.XBound(c => c.EmailAnlageUser);
              columns.XBound(c => c.AnlageUser);
              columns.XBound(c => c.AnlageDatum);
              columns.XBound(c => c.Bemerkung);
          })
          .XAutoColumnConfiguration()
          .ClientEvents(events => events.OnDataBound("LoadingHide"))
          .XPageSize(10)
          .XSort(sortOrder => sortOrder.Add(c => c.AnlageDatum).Descending())
          )
</div>

<div id="divFahrzeugAnforderungDetails" class="hide"></div>

<script>
    
    function FahrzeugAnforderungNew() {
        $.ajax(
            {
                type: "POST",
                url: "/ServicesMvc/Equi/FahrzeugAnforderungNew",
                data: {},
                loadingShow: true,
                success: function (result) {
                    ShowFahrzeugAnforderungDetails(result);
                }
            });
    }

    function ShowFahrzeugAnforderungDetails(result) {
        $("#divFahrzeugAnforderungDetails").html(result);
        GridFahrzeugAnforderungDetailsFormPreparePrivateAjax();
        $("#divFahrzeugAnforderungGrid").slideUp(function () {
            $("#divFahrzeugAnforderungDetails").show();
        });
    }

    function CloseFahrzeugAnforderungDetailsInner() {
        $("#divFahrzeugAnforderungDetails").slideUp(function () {
            $("#divFahrzeugAnforderungGrid").delay(200).show();
            window.scrollTo(0, 0);
        });
    }

    function CloseFahrzeugAnforderungDetails() {
        CloseFahrzeugAnforderungDetailsInner();
        $("#GridFahrzeugAnforderungen").data("tGrid").ajaxRequest();
    }

    function FahrzeugAnforderungAjaxFormComplete() {
        setTimeout('LoadingHide()', 800);
        FormPrepareAjax();
        if (_modelIsValid)
            CloseFahrzeugAnforderungDetails();
    }

    var _modelIsValid = false;
    var _modelIsInsertMode = false;

    function GridFahrzeugAnforderungDetailsFormPreparePrivateAjax() {
        FormPrepareAjax();

        LoadingHide();
        GridLoadingHide();

        $("button[type='submit']").click(function () {
            LoadingShow();
        });
    }
    
</script>