@model CkgDomainLogic.DomainCommon.ViewModels.DocumentViewModel

<div id="divDokumentGrid">

    <div class="@(Model.GeneralMode && !Model.AdminMode ? "kroschkedokumentencenter-grid" : "")">
        @Html.Partial("DocumentGrid")
    </div>

@if (Model.GeneralMode && !Model.AdminMode)
{
    <div class="kroschkedokumentencenter-hint">
        @Localize.HereYouCanFindAllDocumentsRegarding
    </div>
}

</div>

<div id="divDocumentDetails"></div>

<script type="text/javascript" >

    function GetDocumentGrid() {
        return $("#DokumentGrid").data("tGrid");
    }

    function DocumentGridRefresh() {
        GetDocumentGrid().ajaxRequest();
    }

    function DocumentGridLoadingHide() {
        // needed for chrome browser: Explicitely hide grids loading icon on multiple subsequent grid ajax requests (because of filter control initializing)
        setTimeout('$("#DokumentGridItems .t-grid-pager .t-status .t-icon").removeClass("t-loading")', 500);
    }

    function OnDataBound_DokumentGrid() {
        FilteredData_Grid_OnDataBound($(this));
        $('.tooltips').tooltip();
    }

    function OnColumnShowHide_DokumentGrid() {
        FilteredData_Grid_OnColumnShowHide($(this));
    }

    function OnColumnReorder_DokumentGrid() {
        FilteredData_Grid_OnColumnReorder($(this));
    }

    function DocumentRemove(id) {
        var message = '@Localize.DocumentDoYouReallyWantToDelete.ToJavascriptString()';

        if (!confirm(message)) {
            return;
        }

        var url = "Delete";
        $.ajax({
            type: "POST",
            url: url,
            data: { id: id },
            loadingShow: true,
            success: function (result) {
                DocumentDeleted();
            },
            error: function (result) {
                alert(result.data);
            }
        });
    }

    function DocumentDeleted() {
        TryDocumentGridRefresh();
    }

    function DocumentEdit(id) {

        var url = "Edit/" + id;
        $.ajax({
            type: "GET",
            url: url,
            loadingShow: true,
            success: function (result) {
                ShowDocumentDetails(result);
            },
            error: function (result) {
                alert(result.data);
            }
        });
    }
    
    function DocumentCreate() {
        var url = "CreateDocument/";
        $.ajax({
            type: "GET",
            url: url,
            loadingShow: true,
            success: function (result) {
                ShowDocumentDetails(result);
            },
            error: function (result) {
                alert(result.data);
            }
        });
    }

    function ShowDocumentDetails(result) {
        $("#divDocumentDetails").html(result);
        $("#divDokumentGrid").slideUp();
        $("#divDocumentDetails").slideDown();

        FormPreparePrivateAjax();
    }

    function CloseDocumentDetails() {
        CloseDocumentDetailsInner();
        TryDocumentGridRefresh();
    }

    function TryDocumentGridRefresh() {
        // Refresh grid only
        if (typeof (GetDocumentGrid()) !== "undefined") {
            GetDocumentGrid().ajaxRequest();
        }
    }

    function CloseDocumentDetailsInner() {
        $("#divDocumentDetails").slideUp(function () {
            $("#divDokumentGrid").delay(200).show();
            window.scrollTo(0, 0);
        });
    }

</script>