@model CkgDomainLogic.Remarketing.ViewModels.BelastungsanzeigenViewModel

<h3 class="page-title" id="headerTitle">@Localize.Remarketing_Belastungsanzeigen <small></small></h3>

@Html.SpanAlert("Message")

@section LayoutScript { _controlGroupValidationType = "individual"; }

@using (Html.FormSearchBox())
{
    @Html.Partial("Belastungsanzeigen/Suche", Model.Selektor)
}

@using (Html.FormSearchResultsGrid())
{
    <div id="divGrid"></div>
    <div id="divGridGutachten"></div>
    <div id="divEquiHistorie"></div>
}

<script type="text/javascript">

    var ladeHinweis = '@Localize.LoadingData';

    function FormPreparePrivate() {
    }

    function FormPreparePrivateAjax() {
        FormPrepareAjax();
    }

    function GetGridBelastungsanzeigen() {
        return $("#GridBelastungsanzeigen").data("tGrid");
    }

    function GridLoadingHide() {
        // needed for chrome browser: Explicitely hide grids loading icon on multiple subsequent grid ajax requests (because of filter control initializing)
        setTimeout('$("#GridBelastungsanzeigenItems .t-grid-pager .t-status .t-icon").removeClass("t-loading")', 500);
    }

    function GridBelastungsanzeigenRefresh() {
        GetGridBelastungsanzeigen().ajaxRequest();
    }

    function OnDataBound_GridBelastungsanzeigen() {
        FilteredData_Grid_OnDataBound($(this));
        $('.tooltips').tooltip();

        // prepare multi row selection
        App.initUniform();
        Grid_PrepareMultiRowSelected("GridBelastungsanzeigen");
    }

    function OnLoad_GridBelastungsanzeigen() {
        $('.t-no-data td').text(ladeHinweis);
    }

    function OnColumnShowHide_GridBelastungsanzeigen() {
        FilteredData_Grid_OnColumnShowHide($(this));
    }

    function OnColumnReorder_GridBelastungsanzeigen() {
        FilteredData_Grid_OnColumnReorder($(this));
    }

    function ShowBelastungsanzeigenSearchResult(result) {
        SearchFormHide();
        $("#divGrid").html(result);

        // move our grid filter form into grid's toolbar:
        GridAllColumnFilterApplyToGrid("GridBelastungsanzeigen");

        $("#divGrid").slideDown();
    }

    function OnSelectionChange_GridBelastungsanzeigen(cb) {
        Grid_FormatMultiRowSelected(cb);
        $.ajax({
            type: "POST",
            url: "BelastungsanzeigenSelectionChanged",
            data: { id: cb.val(), isChecked: cb.is(':checked') },
            loadingShow: false,
            success: function (result) {
                GridVorgangAuswahl_MultiSelectUpdate(result.allSelectionCount);
            }
        });
    }

    function OnAllSelectionChange_GridBelastungsanzeigen(check) {
        $.ajax({
            type: "POST",
            url: "BelastungsanzeigenSelectionChanged",
            data: { id: "", isChecked: check },
            loadingShow: true,
            success: function (result) {
                GridVorgangAuswahl_MultiSelectUpdate(result.allSelectionCount);
                FilterGrid("@gridName");
            }
        });
    }

    function GridBelastungsanzeigen_MultiSelectUpdate(count) {
        if (count == 0) {
            $("#uncheckAllRecords").attr("checked", false);
            $.uniform.update($("#uncheckAllRecords"));
            return;
        }

        $("#uncheckAllRecords").attr("checked", true);
    }

    function ShowEquiHistorieAjax(fin) {
        LoadingShow();
        $.ajax(
        {
            type: "POST",
            url: "/ServicesMvc/Equi/GetFahrzeugHistorieRemarketingPartial",
            loadingShow: true,
            data: { fahrgestellnummer: fin },
            success: function (result) {
                ShowEquiHistorie(result);
            }
        });
    }

    function ShowEquiHistorie(result) {
        $("#divEquiHistorie").html(result);
        $("#divGrid").slideUp();
        $("#divEquiHistorie").slideDown();
        $("#btnBackToResult").show();
        setTimeout('LoadingHide()', 1000);
        FormPreparePrivateAjax();
    }

    function CloseEquiHistorieDetail() {
        $("#btnBackToResult").hide();
        $("#divEquiHistorie").html("");
        $("#divEquiHistorie").slideUp(function () { $("#divGrid").delay(200).slideDown(); window.scrollTo(0, 0); });
    }

    function ShowBelastungsanzeigeDetail(result) {
        if (typeof (result.message) !== "undefined") {
            SpanAlertWarning("Message", result.message, 5000);
            return;
        }

        $("#InnerBelastungsanzeigeDetail").html(result);

        $.magnificPopup.open({
            items: { src: $("#InnerBelastungsanzeigeDetail") },
            type: 'inline',
            closeOnBgClick: false,
            alignTop: true,
            removalDelay: 300,
            mainClass: 'my-mfp-zoom-in'
        });
    }

    function SetReklamation(fin) {
        $.ajax(
        {
            type: "POST",
            url: "BelastungsanzeigeSetReklamation",
            data: { fahrgestellNr: fin },
            loadingShow: true,
            success: function (result) {
                ShowBelastungsanzeigeDetail(result);
            }
        });

        return false;
    }

    function ShowReklamation(fin) {
        $.ajax(
        {
            type: "POST",
            url: "BelastungsanzeigeShowReklamation",
            data: { fahrgestellNr: fin },
            loadingShow: true,
            success: function (result) {
                ShowBelastungsanzeigeDetail(result);
            }
        });

        return false;
    }

    function ShowBlockade(fin) {
        $.ajax(
        {
            type: "POST",
            url: "BelastungsanzeigeShowBlockade",
            data: { fahrgestellNr: fin },
            loadingShow: true,
            success: function (result) {
                ShowBelastungsanzeigeDetail(result);
            }
        });

        return false;
    }

    function ShowGutachten(fin) {
        $.ajax(
        {
            type: "POST",
            url: "BelastungsanzeigeShowGutachten",
            data: { fahrgestellNr: fin },
            loadingShow: true,
            success: function (result) {
                ShowGutachten(result);
            }
        });

        return false;
    }

    function SetBlock() {
        $.ajax(
        {
            type: "POST",
            url: "BelastungsanzeigeSetBlock",
            loadingShow: true,
            success: function (result) {
                ShowBelastungsanzeigeDetail(result);
            }
        });

        return false;
    }

    function SetNoBlock() {
        $.ajax(
        {
            type: "POST",
            url: "BelastungsanzeigeSetNoBlock",
            loadingShow: true,
            success: function (result) {
                ShowBelastungsanzeigenSearchResult(result);
            }
        });

        return false;
    }

    function SetInArbeit() {
        $.ajax(
        {
            type: "POST",
            url: "BelastungsanzeigeSetInArbeit",
            loadingShow: true,
            success: function (result) {
                ShowBelastungsanzeigenSearchResult(result);
            }
        });

        return false;
    }

    function SetOpen() {
        $.ajax(
        {
            type: "POST",
            url: "BelastungsanzeigeSetOpen",
            loadingShow: true,
            success: function (result) {
                ShowBelastungsanzeigenSearchResult(result);
            }
        });

        return false;
    }

    function CloseBelastungsanzeigeDetail() {
        $(".mfp-close").trigger("click");
        GridBelastungsanzeigenRefresh();
    }

    function GetGridGutachten() {
        return $("#GridGutachten").data("tGrid");
    }

    function GridLoadingHide() {
        // needed for chrome browser: Explicitely hide grids loading icon on multiple subsequent grid ajax requests (because of filter control initializing)
        setTimeout('$("#GridGutachtenItems .t-grid-pager .t-status .t-icon").removeClass("t-loading")', 500);
    }

    function GridGutachtenRefresh() {
        GetGridGutachten().ajaxRequest();
    }

    function OnDataBound_GridGutachten() {
        FilteredData_Grid_OnDataBound($(this));
        $('.tooltips').tooltip();
    }

    function OnLoad_GridGutachten() {
        $('.t-no-data td').text(ladeHinweis);
    }

    function OnColumnShowHide_GridGutachten() {
        FilteredData_Grid_OnColumnShowHide($(this));
    }

    function OnColumnReorder_GridGutachten() {
        FilteredData_Grid_OnColumnReorder($(this));
    }

    function ShowGutachten(result) {
        $("#divGrid").slideUp();
        $("#divGridGutachten").html(result);

        // move our grid filter form into grid's toolbar:
        GridAllColumnFilterApplyToGrid("GridGutachten");

        $("#divGridGutachten").slideDown();
    }

    function CloseGutachten() {
        $("#divGridGutachten").html("");
        $("#divGridGutachten").slideUp();
        $("#divGrid").slideDown();
    }

</script>

<div id="InnerBelastungsanzeigeDetail" class="white-popup mfp-hide">
</div>
